

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorial: Log Clustering using LogAI &mdash; LogAI  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/theme.css?v=7272f7be" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Deep-learning Anomaly Detection Benchmarking" href="tutorial.nn_ad_benchmarking.html" />
    <link rel="prev" title="Tutorial: Log Anomaly Detection Using LogAI" href="tutorial.build_log_anomaly_detection_app.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            LogAI
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="tutorial.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial.explore_logai_gui_portal.html">Explore LogAI GUI Portal</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.run_simple_time-series_anomaly_detection_application.html">Run Simple Time-series Anomaly Detection Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.build_log_anomaly_detection_app.html">Tutorial: Log Anomaly Detection Using LogAI</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Tutorial: Log Clustering using LogAI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#load-data">Load Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#preprocess">Preprocess</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parsing">Parsing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#information-extraction">Information Extraction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#vectorization-for-unstructured-loglines">Vectorization for unstructured loglines</a></li>
<li class="toctree-l4"><a class="reference internal" href="#categorical-encoding-for-log-attributes">Categorical Encoding for log attributes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#feature-extraction">Feature Extraction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#clustering">Clustering</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.nn_ad_benchmarking.html">Deep-learning Anomaly Detection Benchmarking</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developers' Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="develop.html">Developers’ Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">LogAI Core Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">logai</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">LogAI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="tutorial.html">Tutorials</a></li>
      <li class="breadcrumb-item active">Tutorial: Log Clustering using LogAI</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tutorial.build_log_clustering_app.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <a class="reference internal image-reference" href="_images/logai_logo.jpg"><img alt="_images/logai_logo.jpg" class="align-center" src="_images/logai_logo.jpg" style="width: 650px;" />
</a>
<section id="tutorial-log-clustering-using-logai">
<h1>Tutorial: Log Clustering using LogAI<a class="headerlink" href="#tutorial-log-clustering-using-logai" title="Link to this heading"></a></h1>
<p>This is an example to show how to use LogAI to conduct log clustering analysis.</p>
<section id="load-data">
<h2>Load Data<a class="headerlink" href="#load-data" title="Link to this heading"></a></h2>
<p>You can use <code class="code highlight shell docutils literal highlight-shell">OpensetDataLoader</code> to load a sample open log dataset. Here we use HDFS dataset from
<a class="reference external" href="https://zenodo.org/record/3227177#.Y1M3LezML0o">LogHub</a> as an example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">logai.dataloader.openset_data_loader</span> <span class="kn">import</span> <span class="n">OpenSetDataLoader</span><span class="p">,</span> <span class="n">OpenSetDataLoaderConfig</span>

<span class="c1">#File Configuration</span>
<span class="n">filepath</span> <span class="o">=</span> <span class="s2">&quot;../datasets/HDFS_2000.log&quot;</span>
<span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;datasets&quot;</span><span class="p">,</span> <span class="s2">&quot;HDFS_2000.log&quot;</span><span class="p">)</span>

<span class="n">dataset_name</span> <span class="o">=</span> <span class="s2">&quot;HDFS&quot;</span>
<span class="n">data_loader</span> <span class="o">=</span> <span class="n">OpenSetDataLoader</span><span class="p">(</span>
    <span class="n">OpenSetDataLoaderConfig</span><span class="p">(</span>
        <span class="n">dataset_name</span><span class="o">=</span><span class="n">dataset_name</span><span class="p">,</span>
        <span class="n">filepath</span><span class="o">=</span><span class="n">filepath</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">logrecord</span> <span class="o">=</span> <span class="n">data_loader</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>

<span class="n">logrecord</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="preprocess">
<h2>Preprocess<a class="headerlink" href="#preprocess" title="Link to this heading"></a></h2>
<p>In preprocessing step user can retrieve and replace any regex strings and clean the raw loglines. This
can be very useful to improve information extraction of the unstructured part of logs,
as well as generate more structured attributes with domain knowledge.</p>
<p>Here in the example, we use the below regex to retrieve Block IDs, IP addresses and filepaths.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">logai.preprocess.preprocessor</span> <span class="kn">import</span> <span class="n">PreprocessorConfig</span><span class="p">,</span> <span class="n">Preprocessor</span>
<span class="kn">from</span> <span class="nn">logai.utils</span> <span class="kn">import</span> <span class="n">constants</span>

<span class="n">loglines</span> <span class="o">=</span> <span class="n">logrecord</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="n">constants</span><span class="o">.</span><span class="n">LOGLINE_NAME</span><span class="p">]</span>
<span class="n">attributes</span> <span class="o">=</span> <span class="n">logrecord</span><span class="o">.</span><span class="n">attributes</span>

<span class="n">preprocessor_config</span> <span class="o">=</span> <span class="n">PreprocessorConfig</span><span class="p">(</span>
    <span class="n">custom_replace_list</span><span class="o">=</span><span class="p">[</span>
        <span class="p">[</span><span class="sa">r</span><span class="s2">&quot;(?&lt;=blk_)[-\d]+&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;block_id&gt;&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="sa">r</span><span class="s2">&quot;\d+\.\d+\.\d+\.\d+&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;IP&gt;&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="sa">r</span><span class="s2">&quot;(/[-\w]+)+&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;file_path&gt;&quot;</span><span class="p">],</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">Preprocessor</span><span class="p">(</span><span class="n">preprocessor_config</span><span class="p">)</span>

<span class="n">clean_logs</span><span class="p">,</span> <span class="n">custom_patterns</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">clean_log</span><span class="p">(</span>
    <span class="n">loglines</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="parsing">
<h2>Parsing<a class="headerlink" href="#parsing" title="Link to this heading"></a></h2>
<p>After preprocessing, we call auto-parsing algorithms to automatically parse the cleaned logs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">logai.information_extraction.log_parser</span> <span class="kn">import</span> <span class="n">LogParser</span><span class="p">,</span> <span class="n">LogParserConfig</span>
<span class="kn">from</span> <span class="nn">logai.algorithms.parsing_algo.drain</span> <span class="kn">import</span> <span class="n">DrainParams</span>

<span class="c1"># parsing</span>
<span class="n">parsing_algo_params</span> <span class="o">=</span> <span class="n">DrainParams</span><span class="p">(</span>
    <span class="n">sim_th</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">5</span>
<span class="p">)</span>

<span class="n">log_parser_config</span> <span class="o">=</span> <span class="n">LogParserConfig</span><span class="p">(</span>
    <span class="n">parsing_algorithm</span><span class="o">=</span><span class="s2">&quot;drain&quot;</span><span class="p">,</span>
    <span class="n">parsing_algo_params</span><span class="o">=</span><span class="n">parsing_algo_params</span>
<span class="p">)</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">LogParser</span><span class="p">(</span><span class="n">log_parser_config</span><span class="p">)</span>
<span class="n">parsed_result</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">clean_logs</span><span class="p">)</span>

<span class="n">parsed_loglines</span> <span class="o">=</span> <span class="n">parsed_result</span><span class="p">[</span><span class="s1">&#39;parsed_logline&#39;</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="information-extraction">
<h2>Information Extraction<a class="headerlink" href="#information-extraction" title="Link to this heading"></a></h2>
<section id="vectorization-for-unstructured-loglines">
<h3>Vectorization for unstructured loglines<a class="headerlink" href="#vectorization-for-unstructured-loglines" title="Link to this heading"></a></h3>
<p>Here we use <cite>word2vec</cite> to vectorize unstructured part of the logs. The output will be a list of
numeric vectors that representing the semantic features of these log templates.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">logai.information_extraction.log_vectorizer</span> <span class="kn">import</span> <span class="n">VectorizerConfig</span><span class="p">,</span> <span class="n">LogVectorizer</span>

<span class="n">vectorizer_config</span> <span class="o">=</span> <span class="n">VectorizerConfig</span><span class="p">(</span>
    <span class="n">algo_name</span> <span class="o">=</span> <span class="s2">&quot;word2vec&quot;</span>
<span class="p">)</span>

<span class="n">vectorizer</span> <span class="o">=</span> <span class="n">LogVectorizer</span><span class="p">(</span>
    <span class="n">vectorizer_config</span>
<span class="p">)</span>

<span class="c1"># Train vectorizer</span>
<span class="n">vectorizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">parsed_loglines</span><span class="p">)</span>

<span class="c1"># Transform the loglines into features</span>
<span class="n">log_vectors</span> <span class="o">=</span> <span class="n">vectorizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">parsed_loglines</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="categorical-encoding-for-log-attributes">
<h3>Categorical Encoding for log attributes<a class="headerlink" href="#categorical-encoding-for-log-attributes" title="Link to this heading"></a></h3>
<p>We also do categorical encoding for log attributes to convert the strings into numerical representations.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">logai.information_extraction.categorical_encoder</span> <span class="kn">import</span> <span class="n">CategoricalEncoderConfig</span><span class="p">,</span> <span class="n">CategoricalEncoder</span>

<span class="n">encoder_config</span> <span class="o">=</span> <span class="n">CategoricalEncoderConfig</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;label_encoder&quot;</span><span class="p">)</span>

<span class="n">encoder</span> <span class="o">=</span> <span class="n">CategoricalEncoder</span><span class="p">(</span><span class="n">encoder_config</span><span class="p">)</span>

<span class="n">attributes_encoded</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="feature-extraction">
<h3>Feature Extraction<a class="headerlink" href="#feature-extraction" title="Link to this heading"></a></h3>
<p>Then we extract and concate the semantic features for both the unstructured and structured part of logs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">logai.information_extraction.feature_extractor</span> <span class="kn">import</span> <span class="n">FeatureExtractorConfig</span><span class="p">,</span> <span class="n">FeatureExtractor</span>

<span class="n">timestamps</span> <span class="o">=</span> <span class="n">logrecord</span><span class="o">.</span><span class="n">timestamp</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">FeatureExtractorConfig</span><span class="p">(</span>
    <span class="n">max_feature_len</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>

<span class="n">feature_extractor</span> <span class="o">=</span> <span class="n">FeatureExtractor</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

<span class="n">_</span><span class="p">,</span> <span class="n">feature_vector</span> <span class="o">=</span> <span class="n">feature_extractor</span><span class="o">.</span><span class="n">convert_to_feature_vector</span><span class="p">(</span><span class="n">log_vectors</span><span class="p">,</span> <span class="n">attributes_encoded</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="clustering">
<h2>Clustering<a class="headerlink" href="#clustering" title="Link to this heading"></a></h2>
<p>Here we use K-Means clustering algorithm as an example. We set the number of clusters to 7 in
K-Means algorithm parameter configuration.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">logai.algorithms.clustering_algo.kmeans</span> <span class="kn">import</span> <span class="n">KMeansParams</span>
<span class="kn">from</span> <span class="nn">logai.analysis.clustering</span> <span class="kn">import</span> <span class="n">ClusteringConfig</span><span class="p">,</span> <span class="n">Clustering</span>

<span class="n">clustering_config</span> <span class="o">=</span> <span class="n">ClusteringConfig</span><span class="p">(</span>
    <span class="n">algo_name</span><span class="o">=</span><span class="s1">&#39;kmeans&#39;</span><span class="p">,</span>
    <span class="n">algo_params</span><span class="o">=</span><span class="n">KMeansParams</span><span class="p">(</span>
        <span class="n">n_clusters</span><span class="o">=</span><span class="mi">7</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">log_clustering</span> <span class="o">=</span> <span class="n">Clustering</span><span class="p">(</span><span class="n">clustering_config</span><span class="p">)</span>

<span class="n">log_clustering</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">feature_vector</span><span class="p">)</span>

<span class="n">cluster_id</span> <span class="o">=</span> <span class="n">log_clustering</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">feature_vector</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;cluster_id&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then you can check the clustering results</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check clustering results.</span>
<span class="n">logrecord</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cluster_id</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>To run this example, you can check the
<a class="reference external" href="https://github.com/salesforce/logai/blob/main/examples/jupyter_notebook/tutorial_log_clustering.ipynb">jupyter notebook</a>
example on Github.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="tutorial.build_log_anomaly_detection_app.html" class="btn btn-neutral float-left" title="Tutorial: Log Anomaly Detection Using LogAI" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tutorial.nn_ad_benchmarking.html" class="btn btn-neutral float-right" title="Deep-learning Anomaly Detection Benchmarking" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Salesforce.com, Inc..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>